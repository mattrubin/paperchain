!function(a,b,c){"use strict";b.module("ngResource",["ng"]).factory("$resource",["$http","$parse",function(a,d){function e(a){return f(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function f(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function g(a,b){this.template=a+="#",this.defaults=b||{};var c=this.urlParams={};k(a.split(/\W/),function(b){b&&new RegExp("(^|[^\\\\]):"+b+"\\W").test(a)&&(c[b]=!0)}),this.template=a.replace(/\\:/g,":")}function h(d,e,f){function p(a,b){var c={};return b=l({},e,b),k(b,function(b,d){c[d]=b.charAt&&"@"==b.charAt(0)?o(a,b.substr(1)):b}),c}function q(a){m(a||{},this)}var r=new g(d);return f=l({},i,f),k(f,function(d,e){d.method=b.uppercase(d.method);var f="POST"==d.method||"PUT"==d.method||"PATCH"==d.method;q[e]=function(b,c,e,g){var h,i={},o=j,s=null;switch(arguments.length){case 4:s=g,o=e;case 3:case 2:if(!n(c)){i=b,h=c,o=e;break}if(n(b)){o=b,s=c;break}o=c,s=e;case 1:n(b)?o=b:f?h=b:i=b;break;case 0:break;default:throw"Expected between 0-4 arguments [params, data, success, error], got "+arguments.length+" arguments."}var t=this instanceof q?this:d.isArray?[]:new q(h);return a({method:d.method,url:r.url(l({},p(h,d.params||{}),i)),data:h}).then(function(a){var b=a.data;b&&(d.isArray?(t.length=0,k(b,function(a){t.push(new q(a))})):m(b,t)),(o||j)(t,a.headers)},s),t},q.prototype["$"+e]=function(a,b,d){var g,h=p(this),i=j;switch(arguments.length){case 3:h=a,i=b,g=d;break;case 2:case 1:n(a)?(i=a,g=b):(h=a,i=b||j);case 0:break;default:throw"Expected between 1-3 arguments [params, success, error], got "+arguments.length+" arguments."}var k=f?this:c;q[e].call(this,h,k,i,g)}}),q.bind=function(a){return h(d,l({},e,a),f)},q}var i={get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},j=b.noop,k=b.forEach,l=b.extend,m=b.copy,n=b.isFunction,o=function(a,b){return d(b)(a)};return g.prototype={url:function(a){var c,d,g=this,h=this.template;a=a||{},k(this.urlParams,function(f,i){c=a.hasOwnProperty(i)?a[i]:g.defaults[i],b.isDefined(c)&&null!==c?(d=e(c),h=h.replace(new RegExp(":"+i+"(\\W)","g"),d+"$1")):h=h.replace(new RegExp("(/?):"+i+"(\\W)","g"),function(a,b,c){return"/"==c.charAt(0)?c:b+c})}),h=h.replace(/\/?#$/,"");var i=[];return k(a,function(a,b){g.urlParams[b]||i.push(f(b)+"="+f(a))}),i.sort(),h=h.replace(/\/*$/,""),h+(i.length?"?"+i.join("&"):"")}},h}])}(window,window.angular),angular.module("adn",["ui"]),angular.module("adn").provider("ADNConfig",function(){this.configuation={},this.$get=function(){return{config:this.configuation,get:function(a,b){return this.config.hasOwnProperty(a)?this.config[a]:b}}},this.setConfig=function(a){this.configuation=angular.extend({},this.configuation,a)}}),angular.module("adn").factory("Auth",["$rootScope","$location",function(a,b){return a.local=JSON.parse("undefined"!=typeof localStorage.data?localStorage.data:"{}"),a.$watch("local",function(){localStorage.data=JSON.stringify(a.local)},!0),{isLoggedIn:function(b){return void 0===b&&(b=a.local),b&&"undefined"!=typeof b.accessToken},logout:function(){a.local={},localStorage.clear()},login:function(){a.local.accessToken=a.local.accessToken||jQuery.url(b.absUrl()).fparam("access_token"),b.hash("")}}}]),angular.module("adn").factory("ApiClient",["$rootScope","$http","ADNConfig",function(a,b,c){var d=["get","head","post","put","delete","jsonp"],e=function(d){return function(e){return e.headers=e.headers||{},a.local&&a.local.accessToken&&(e.headers.Authorization="Bearer "+a.local.accessToken),e.url=c.get("api_client_root","https://alpha-api.app.net/stream/0/")+e.url,e.method=d,"post"===d&&e.data&&!e.headers["Content-Type"]&&(e.data=jQuery.param(e.data),e.headers["Content-Type"]="application/x-www-form-urlencoded"),"get"===d&&e.data&&(e.url=e.url+"?"+jQuery.param(e.data)),b(e)}},f={};return _.each(d,function(a){f[a]=e(a)}),f.postJson=function(a){return a.headers=a.headers||{},a.headers["Content-Type"]="application/json",(!angular.isString(a.data)&&angular.isObject(a.data)||angular.isArray(a.data))&&(a.data=angular.toJson(a.data)),f.post(a)},f.createChannel=function(a){return f.post({url:"/channels",data:a})},f.updateChannel=function(a,b){return f.put({url:"/channels/"+a.id,data:b})},f.getBroadcastChannels=function(){return f.get({url:"/channels",params:{channel_types:"net.app.core.broadcast"}})},f.getChannel=function(a){return f.get({url:"/channels/"+a})},f.subscribeToChannel=function(a){return f.post({url:"/channels/"+a.id+"/subscribe"})},f.unsubscribeFromChannel=function(a){return f.delete({url:"/channels/"+a.id+"/subscribe"})},f.createMessage=function(a,b){return f.postJson({url:"/channels/"+a.id+"/messages",data:b})},f.getMessages=function(a,b){var c={url:"/channels/"+a.id+"/messages",data:{}};return b&&(c.data.include_annotations=1),f.get(c)},f.getMultipleUsers=function(a){return f.get({params:{ids:a}})},f.searchUsers=function(a){return f.get({params:a,url:"/users/search"})},f.getChannelMetadata=function(a){var b=_.find(a.annotations,function(a){return"net.app.core.broadcast.metadata"===a.type&&a.value.title&&a.value.description});return b?b.value:{title:"Channel "+a.id,description:""}},a.channels=[],f.getBroadcastChannels().success(function(b){a.channels=_.filter(b.data,function(a){return a.you_subscribed})}),f}]),function(){"use strict";angular.module("adn").factory("User",["$http","$q","ApiClient",function(a,b,c){var d=function(a,b){a?this.complete(b):(b.is_complete=!1,angular.extend(this,b))};return d.prototype.complete=function(a){return angular.extend(this,a),this.is_complete=!0,this.text="@"+this.username+" ("+this.name+")",this},d._cache={},d._pending=[],d.update=function(a){if(a){var b=d._cache[a.id||0];return b?(d._pending=_.without(d._pending,b),b.complete(a)):(d._cache[a.id]=new d(!0,a),d._cache[a.id])}},d.bulk_get=function(a,c){var e={},f=b.defer();return _.each(_.uniq(a),function(a){var b=d._cache[a];b||(b=d._cache[a]=new d(!1,{id:a}),d._pending.push(b)),e[a]=b}),c?d.fetch_pending().then(function(){f.resolve(e)}):f.resolve(e),f.promise},d.fetch_pending=function(){var a=d._pending;d._pending=[];for(var e=function(a){_.each(a.data.data,function(a){d.update(a)})},f=[];a.length;){var g=_.first(a,200);a=_.rest(a,200);var h=_.pluck(g,"id").join(),i=c.getMultipleUsers(h);i.then(e),f.push(i)}return b.all(f)},d}])}(),function(){"use strict";angular.module("adn").directive("adnText",function(){return{restrict:"A",link:function(a){a.offset=0,void 0===a.textData.rawText&&(a.textData.rawText=""),a.updateCounter=function(){a.charCount=a.maxChars-a.offset-a.textData.rawText.length},a.$watch("[maxChars, offset, textData]",a.updateCounter,!0),a.updateCounter(),a.buttonClick=function(){a.textData.rawText.length<=a.maxChars&&(a.textData.processedMessage={text:a.textData.rawText},a.onButtonClick())}},templateUrl:"templates/adn-text.html",scope:{buttonText:"@",onButtonClick:"&",maxChars:"@",textData:"="}}})}(),function(){"use strict";angular.module("adn").controller("UserSearchCtrl",["$scope","User","ApiClient",function(a,b,c){var d=function(d){return{multiple:!0,minimumInputLength:1,tokenSeparators:[","," "],createSearchChoice:function(a){return a},width:"resolve",query:function(e){"@"!==e.term.charAt(0)&&"#"!==e.term.charAt(0)&&(e.term="@"+e.term);var f={q:e.term,include_users:d||"any"};c.searchUsers(f).success(function(a){var c=_.map(a.data,function(a){return b.update(a)});e.callback({results:c})}).error(function(){console.log("error",arguments)}).always(function(){console.log("always",arguments)}),a.$apply()}}};a.usernameSelect=d()}]),angular.module("adn").directive("userSearch",function(){return{restrict:"A",controller:"UserSearchCtrl",templateUrl:"templates/user-search.html",replace:!0,scope:{label:"=",selectedUsers:"=",include_users:"="}}})}(),angular.module("adn").run(["$templateCache",function(a){a.put("templates/adn-text.html",'<div class="well-plain well-elevated">\n    <div>\n        <textarea class="editable input-flex" ng-model="textData.rawText" ng-trim="false" tabindex=1></textarea>\n    </div>\n    <div>\n      <span class="text-left char-count">{{ charCount }}</span>\n      <span class="pull-right">\n        <button class="btn btn-primary btn-small" tabindex=2 ng-disabled="charCount < 0" ng-click="buttonClick()">{{ buttonText }}</button>\n      </span>\n    </div>\n</div>'),a.put("templates/user-search.html",'<div>\n  <!-- originally from ohe -->\n  <label class="control-label" ng-bind=\'label\'></label>\n  <input class=\'input-block-level\' type="hidden" ui-select2="usernameSelect" ng-model="selectedUsers" ng-multiple>\n</div>')}]);